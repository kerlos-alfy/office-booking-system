<%- include('partials/header') %>

<h1 class="mb-4 text-primary">üìÑ Booking Details</h1>
<!-- Release Office Button -->
<form method="POST" action="/bookings/<%= booking._id %>/archive" onsubmit="return confirm('Are you sure you want to release this office? This booking will be archived.')">
    <button type="submit" class="btn btn-warning mt-3">üì¶ Release Office (Archive Booking)</button>
</form>

<!-- Basic Booking Info -->
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">Office: <%= booking.office_id?.office_number %> (Floor: <%= booking.office_id?.floor || 'N/A' %>)</h5>
        <p class="card-text">Client: <%= booking.client_id?.name || 'N/A' %></p>
        <p class="card-text">Page Number: <%= booking.page_no %></p>
        <p class="card-text">Start Date: <%= new Date(booking.start_date).toISOString().split('T')[0] %></p>
        <p class="card-text">End Date: <%= new Date(booking.end_date).toISOString().split('T')[0] %></p>
    </div>
</div>

<!-- Financial Info -->
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">üí∞ Financial Details</h5>
        <p class="card-text">Total Price: $<%= booking.total_price %></p>
        <p class="card-text">Down Payment: $<%= booking.initial_payment %></p>
        <p class="card-text">VAT: $<%= booking.vat %></p>
        <p class="card-text">Security Deposit: $<%= booking.sec_deposit %></p>
        <p class="card-text">Admin Fee: $<%= booking.admin_fee %></p>
        <p class="card-text">Commission: $<%= booking.commission %></p>
        <p class="card-text">Ejari Number: <%= booking.ejari_no %></p>
    </div>
</div>

<!-- Payments Table -->
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">üíµ Payments</h5>

        <% if (booking.payments.length === 0) { %>
            <div class="alert alert-info">No payments recorded.</div>
        <% } else { %>
            <table class="table table-bordered table-hover bg-white">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Amount</th>
                        <th>Payment Date</th>
                        <th>Payment Type</th>
                    </tr>
                </thead>
                <tbody>
                    <% booking.payments.forEach((p, index) => { %>
                        <tr>
                            <td><%= index + 1 %></td>
                            <td>$<%= p.amount %></td>
                            <td><%= new Date(p.payment_date).toISOString().split('T')[0] %></td>
                            <td><%= p.payment_type %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        <% } %>
    </div>
</div>

<!-- Cheques Table -->
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">üìù Cheques</h5>

        <% if (booking.cheques.length === 0) { %>
            <div class="alert alert-info">No cheques recorded.</div>
        <% } else { %>
            <table class="table table-bordered table-hover bg-white">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Amount</th>
                        <th>Due Date</th>
                    </tr>
                </thead>
                <tbody>
                    <% booking.cheques.forEach((c, index) => { %>
                        <tr>
                            <td><%= index + 1 %></td>
                            <td>$<%= c.amount %></td>
                            <td><%= new Date(c.due_date).toISOString().split('T')[0] %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        <% } %>
    </div>
</div>

<%- include('partials/footer') %>
